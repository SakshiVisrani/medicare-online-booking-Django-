{% extends "base.html" %}

{% block content %}



<div class="doctor-page-layout">
  <div class="left-column">
      <div class="detailed-doctor-card-container">
          <div class="detailed-doctor-card">
              <div class="doctor-profile-header">
                  <div class="doctor-avatar-section">
                      <img src="{{doctor.image.url}}" alt="Dr. Sarah Johnson" class="profile-avatar">
                      
                      <div class="verified-icon"><i class="fas fa-check-circle"></i></div>
                  </div>
                  <div class="doctor-main-info">
                      <h1 class="doctor-name">Dr.{{doctor.name}}</h1>
                      <p class="doctor-specialty">{{doctor.speciality}}</p>
                      <div class="doctor-rating">
                          <i class="fas fa-star yellow"></i>
                          <i class="fas fa-star yellow"></i>
                          <i class="fas fa-star yellow"></i>
                          <i class="fas fa-star yellow"></i>
                          <i class="fas fa-star-half-alt yellow"></i>
                          <span class="rating-text">{{doctor.rating}}</span>
                      </div>
                  </div>
                  <div class="social-icons">
                      <button class="social-btn heart-btn"><i class="far fa-heart"></i></button>
                      <button class="social-btn call-btn"><i class="fas fa-phone-alt"></i></button>
                      <button class="social-btn message-btn"><i class="far fa-envelope"></i></button>
                  </div>
              </div>

              <div class="doctor-details-grid">
                  <div class="detail-item">
                      <i class="fas fa-briefcase detail-icon"></i>
                      <span><span class="detail-value">{{doctor.experience}}</span> Experience</span>
                  </div>
                  <div class="detail-item">
                      <i class="fas fa-map-marker-alt detail-icon"></i>
                      <span><span class="detail-value">{{doctor.location}}</span> Location</span>
                  </div>
                  <div class="detail-item">
                      <i class="fas fa-users detail-icon"></i>
                      <span><span class="detail-value">2,500+</span> Patients Treated</span>
                  </div>
                  <div class="detail-item">
                      <i class="fas fa-clock detail-icon"></i>
                      <span><span class="detail-value">{{doctor.response_time}}</span> Response Time</span>
                  </div>
              </div>

              <div class="doctor-degrees-section">
                  <span class="degree-tag">MD</span>
                  <span class="degree-tag">MBBS</span>
                  <span class="degree-tag">DM Cardiology</span>
                  <span class="degree-tag">FACC</span>
              </div>

              <p class="languages-spoken"><i class="fas fa-language"></i> clinic name : <span class="lang-list">{{doctor.clinic_name}}</span></p>

              <div class="card-footer-badges detailed-page">
                  <span class="footer-badge"><i class="fas fa-check-circle"></i> Verified Doctor</span>
                  <span class="footer-badge"><i class="fas fa-star"></i> Top Rated</span>
                  <span class="footer-badge"><i class="fas fa-shield-alt"></i> HIPAA Compliant</span>
              </div>
          </div>
      </div>

      <div class="doctor-info-card-container">
          <div class="doctor-info-card">
              <div class="tab-navigation">
                  <button class="tab-button active" data-tab="overview">
                      <i class="fas fa-file-alt"></i> Overview
                  </button>
                  <button class="tab-button" data-tab="experience">
                      <i class="fas fa-briefcase"></i> Experience
                  </button>
                  <button class="tab-button" data-tab="reviews">
                      <i class="fas fa-star"></i> Reviews
                  </button>
                  <button class="tab-button" data-tab="availability">
                      <i class="fas fa-calendar-alt"></i> Availability
                  </button>
              </div>

              <div class="tab-content">
                  <div id="overview" class="tab-pane active">
                      <h2 class="section-title">About Dr. {{doctor.name}}</h2>
                      <p class="about-text">
                          Dr. {{doctor.name}} is a highly experienced {{doctor.speciality}} with over {{doctor.experience}} years of practice.
                          Specializing in advanced procedures and preventive care, Dr. {{doctor.name}} has
                          successfully treated thousands of patients and is known for their compassionate approach
                          to healthcare. They are committed to providing personalized treatment plans and staying
                          updated with the latest medical advancements.
                      </p>

                      <h3 class="section-subtitle">Specializations</h3>
                      <div class="specialization-tags">
                          <span class="specialization-tag"><i class="fas fa-check-circle"></i> Interventional Cardiology</span>
                          <span class="specialization-tag"><i class="fas fa-check-circle"></i> Cardiac Catheterization</span>
                          <span class="specialization-tag"><i class="fas fa-check-circle"></i> Heart Disease Prevention</span>
                          <span class="specialization-tag"><i class="fas fa-check-circle"></i> Hypertension Management</span>
                          <span class="specialization-tag"><i class="fas fa-check-circle"></i> Cholesterol Management</span>
                          <span class="specialization-tag"><i class="fas fa-check-circle"></i> Cardiac Rehabilitation</span>
                      </div>

                      <h3 class="section-subtitle">Services Offered</h3>
                      <div class="services-offered-grid">
                          <div class="service-option-card">
                              <span class="service-name">In-person Consultation</span>
                              <span class="service-price">₹800</span>
                              <p class="service-description">Comprehensive physical examination</p>
                          </div>
                          <div class="service-option-card">
                              <span class="service-name">Video Consultation</span>
                              <span class="service-price">₹600</span>
                              <p class="service-description">Online consultation via video call</p>
                          </div>
                          <div class="service-option-card">
                              <span class="service-name">Follow-up Consultation</span>
                              <span class="service-price">₹500</span>
                              <p class="service-description">Post-treatment follow-up session</p>
                          </div>
                          <div class="service-option-card">
                              <span class="service-name">Emergency Consultation</span>
                              <span class="service-price">₹1200</span>
                              <p class="service-description">24/7 emergency medical consultation</p>
                          </div>
                      </div>
                  </div>

                  <div id="experience" class="tab-pane">
                      <h2 class="section-title">Experience & Education</h2>
                      <p>Detailed information about Dr. {{doctor.name}} professional experience and educational background.</p>
                      <ul>
                          <li>**Senior Cardiologist**, Apollo Hospitals, Mumbai (2015 - Present)</li>
                          <li>**Consultant Cardiologist**, Lilavati Hospital, Mumbai (2010 - 2015)</li>
                          <li>**Fellowship (FACC)**, American College of Cardiology (2010)</li>
                          <li>**DM Cardiology**, All India Institute of Medical Sciences (AIIMS), Delhi (2007)</li>
                          <li>**MD Internal Medicine**, Grant Medical College, Mumbai (2004)</li>
                          <li>**MBBS**, Seth G.S. Medical College, Mumbai (2001)</li>
                      </ul>
                  </div>

                  <div id="reviews" class="tab-pane">
                      <h2 class="section-title">Patient Reviews</h2>
                      <p>Read what patients are saying about Dr. {{doctor.name}}.</p>
                      <div class="review-list">
                          <div class="patient-review">
                              <div class="review-header">
                                  <span class="reviewer-name">Rahul S.</span>
                                  <div class="review-stars">
                                      <i class="fas fa-star yellow"></i><i class="fas fa-star yellow"></i><i class="fas fa-star yellow"></i><i class="fas fa-star yellow"></i><i class="fas fa-star yellow"></i>
                                  </div>
                              </div>
                              <p class="review-text">"Dr. Johnson is incredibly thorough and empathetic. She explained my condition clearly."</p>
                              <span class="review-date">Reviewed on May 10, 2024</span>
                          </div>
                          <div class="patient-review">
                              <div class="review-header">
                                  <span class="reviewer-name">Priya K.</span>
                                  <div class="review-stars">
                                      <i class="fas fa-star yellow"></i><i class="fas fa-star yellow"></i><i class="fas fa-star yellow"></i><i class="fas fa-star yellow"></i><i class="fas fa-star-half-alt yellow"></i>
                                  </div>
                              </div>
                              <p class="review-text">"Excellent doctor! Very professional and caring. Highly recommend."</p>
                              <span class="review-date">Reviewed on April 22, 2024</span>
                          </div>
                      </div>
                  </div>

                  <div id="availability" class="tab-pane">
                    <h2 class="section-title">Available Time Slots</h2>
                
                    <h3 class="select-date-heading">Select Date</h3>
                    <div class="date-selection-grid">
                        <div class="date-option-card active" data-date="today">
                            <span class="day-of-week">Today</span>
                            <span class="slots-available">6 slots</span>
                        </div>
                        <div class="date-option-card" data-date="tomorrow">
                            <span class="day-of-week">Tomorrow</span>
                            <span class="slots-available">8 slots</span>
                        </div>
                        <div class="date-option-card" data-date="wed">
                            <span class="day-of-week">Wed</span>
                            <span class="slots-available">5 slots</span>
                        </div>
                        <div class="date-option-card" data-date="thu">
                            <span class="day-of-week">Thu</span>
                            <span class="slots-available">7 slots</span>
                        </div>
                        <div class="date-option-card" data-date="fri">
                            <span class="day-of-week">Fri</span>
                            <span class="slots-available">4 slots</span>
                        </div>
                    </div>
                
                    <div class="available-times-section">
                        <h3 class="section-subtitle" style="margin-top: 25px;">Available Times</h3>
                        <div class="time-slots-grid">
                            <span class="time-slot-tag">9:00 AM</span>
                            <span class="time-slot-tag">10:00 AM</span>
                            <span class="time-slot-tag">11:00 AM</span>
                            <span class="time-slot-tag">12:00 PM</span>
                            <span class="time-slot-tag">2:00 PM</span>
                            <span class="time-slot-tag">3:00 PM</span>
                            <span class="time-slot-tag">4:00 PM</span>
                            <span class="time-slot-tag">5:00 PM</span>
                            <span class="time-slot-tag">6:00 PM</span>
                        </div>
                    </div>
                </div>
              </div>
          </div>
      </div>
  </div>

  <ul>
    {% for appt in appointments %}
      <li>{{ appt.date }} at {{ appt.time }} - Booked by {{ appt.patient.username }}</li>
    {% endfor %}
  </ul>

  <div class="right-column">
    <div class="book-appointment-card">
      <h2 class="book-appointment-title">Book Appointment</h2>
      <h3 class="consultation-type-heading">Consultation Type</h3>
  
      <form method="POST" action="{% url 'book-slot' %}">
        {% csrf_token %}
        <input type="hidden" name="doctor_id" value="{{ doctor.id }}">
  
        <div class="consultation-options">
          <label class="consultation-option-card clinic-visit-selected">
            <input type="radio" name="consultation_type" value="clinic_visit" checked>
            <div class="option-content">
              <div class="option-header">
                <i class="fas fa-hospital option-icon"></i>
                <span class="option-name">Clinic Visit</span>
              </div>
              <p class="option-description">In-person consultation</p>
              <span class="option-price">₹{{ doctor.consultation_fee }}</span>
            </div>
          </label>
  
          <label class="consultation-option-card">
            <input type="radio" name="consultation_type" value="video_call">
            <div class="option-content">
              <div class="option-header">
                <i class="fas fa-video option-icon"></i>
                <span class="option-name">Video Call</span>
              </div>
              <p class="option-description">Online consultation</p>
              <span class="option-price">₹{{ doctor.online_consultation }}</span>
            </div>
          </label>
        </div> {# consultation-options end #}
  
        <div class="price-breakdown-section">
          <h3 class="section-subtitle">Price Breakdown</h3>
          <div class="price-item">
            <span class="price-label">Consultation Fee:</span>
            <span id="consultation-fee" class="price-value">₹{{ doctor.consultation_fee }}</span>
          </div>
          <div class="price-item">
            <span class="price-label">Platform Fee:</span>
            <span id="platform-fee" class="price-value">₹{{ doctor.platform_fee }}</span>
          </div>
          <div class="price-item total-price">
            <span class="price-label">Taxes (18%):</span>
            <span id="taxes" class="price-value">₹0</span>
          </div>
          <div class="price-item total-price">
            <span class="price-label">Total:</span>
            <span id="total-price" class="price-value">₹0</span>
          </div>
        </div>
  
        <div class="quick-information-section">
          <h3 class="section-subtitle">Quick Information</h3>
          <div class="info-item">
            <i class="fas fa-clock info-icon"></i>
            <div class="info-text">
              <span class="info-label">Next Available</span>
              <span class="info-value">Today 2:00 PM</span>
            </div>
          </div>
          <div class="info-item">
            <i class="fas fa-comment-dots info-icon"></i>
            <div class="info-text">
              <span class="info-label">Response Time</span>
              <span class="info-value">15 mins</span>
            </div>
          </div>
          <div class="info-item">
            <i class="fas fa-users info-icon"></i>
            <div class="info-text">
              <span class="info-label">Patients Treated</span>
              <span class="info-value">2,500+ patients</span>
            </div>
          </div>
          <div class="info-item">
            <i class="fas fa-globe-americas info-icon"></i>
            <div class="info-text">
              <span class="info-label">Consultation Types</span>
              <span class="info-value">In-person & Video</span>
            </div>
          </div>
        </div>
  
        <button type="submit" class="book-appointment-btn" style="margin-top: 20px;">Pay with Razorpay</button>
      </form>
    </div>
  </div>

  
<script>
  // Simple JavaScript for tab switching
  document.addEventListener('DOMContentLoaded', () => {
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabPanes = document.querySelectorAll('.tab-pane');

      tabButtons.forEach(button => {
          button.addEventListener('click', () => {
              // Deactivate all buttons and hide all panes
              tabButtons.forEach(btn => btn.classList.remove('active'));
              tabPanes.forEach(pane => pane.classList.remove('active'));

              // Activate clicked button
              button.classList.add('active');

              // Show corresponding pane
              const targetTab = button.dataset.tab;
              document.getElementById(targetTab).classList.add('active');
          });
      });

      // Optional: Add logic for consultation option selection (like adding a class)
      const consultationOptions = document.querySelectorAll('.consultation-option-card input[type="radio"]');
      consultationOptions.forEach(radio => {
          radio.addEventListener('change', () => {
              consultationOptions.forEach(r => r.closest('.consultation-option-card').classList.remove('clinic-visit-selected'));
              if (radio.checked) {
                  radio.closest('.consultation-option-card').classList.add('clinic-visit-selected');
              }
          });
      });
  });

  document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Deactivate all buttons and hide all panes
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));

            // Activate clicked button
            button.classList.add('active');

            // Show corresponding pane
            const targetTab = button.dataset.tab;
            document.getElementById(targetTab).classList.add('active');

            // If switching to Availability tab, ensure first date is active and times are shown
            if (targetTab === 'availability') {
                const firstDateCard = document.querySelector('.date-selection-grid .date-option-card');
                const availableTimesSection = document.querySelector('.available-times-section');

                // Reset active state for all date cards
                document.querySelectorAll('.date-option-card').forEach(card => card.classList.remove('active'));
                // Set the first date card as active
                if (firstDateCard) {
                    firstDateCard.classList.add('active');
                }
                // Show the available times section
                if (availableTimesSection) {
                    availableTimesSection.classList.add('show');
                }
            }
        });
    });

    // Optional: Add logic for consultation option selection (like adding a class)
    const consultationOptions = document.querySelectorAll('.consultation-option-card input[type="radio"]');
    consultationOptions.forEach(radio => {
        radio.addEventListener('change', () => {
            consultationOptions.forEach(r => r.closest('.consultation-option-card').classList.remove('clinic-visit-selected'));
            if (radio.checked) {
                radio.closest('.consultation-option-card').classList.add('clinic-visit-selected');
            }
        });
    });

    // --- New JavaScript for Date and Time Slot Selection ---
    const dateOptionCards = document.querySelectorAll('.date-option-card');
    const availableTimesSection = document.querySelector('.available-times-section');
    const timeSlotTags = document.querySelectorAll('.time-slot-tag'); // Get all time slots

    // Handle Date Card Clicks
    dateOptionCards.forEach(card => {
        card.addEventListener('click', () => {
            // Remove 'active' class from all date cards
            dateOptionCards.forEach(c => c.classList.remove('active'));

            // Add 'active' class to the clicked card
            card.classList.add('active');

            // Show the available times section
            availableTimesSection.classList.add('show');

            // Optional: You could fetch/update time slots based on the selected date here
            // For this example, we're just showing the static list.
        });
    });

    // Handle Time Slot Tag Clicks (Optional: for selection feedback)
    timeSlotTags.forEach(slot => {
        slot.addEventListener('click', () => {
            // Remove 'selected' class from all time slots
            timeSlotTags.forEach(s => s.classList.remove('selected'));

            // Add 'selected' class to the clicked time slot
            slot.classList.add('selected');
        });
    });

    // Initial state: When page loads, if Availability is the default active tab,
    // ensure the "Today" date card is active and times are shown.
    const initialActiveTab = document.querySelector('.tab-button.active');
    if (initialActiveTab && initialActiveTab.dataset.tab === 'availability') {
         const firstDateCard = document.querySelector('.date-selection-grid .date-option-card');
         if (firstDateCard) {
             firstDateCard.classList.add('active');
         }
         if (availableTimesSection) {
            availableTimesSection.classList.add('show');
         }
    }
});

document.addEventListener('DOMContentLoaded', () => {
    const consultationFees = {
      clinic_visit: parseFloat("{{ doctor.consultation_fee }}"),
      video_call: parseFloat("{{ doctor.online_consultation }}")
    };
    const platformFee = parseFloat("{{ doctor.platform_fee }}");
    const taxRate = 0.18;

    const consultationFeeEl = document.getElementById('consultation-fee');
    const platformFeeEl = document.getElementById('platform-fee');
    const taxesEl = document.getElementById('taxes');
    const totalPriceEl = document.getElementById('total-price');

    function updatePrices(selectedType) {
      const consultationFee = consultationFees[selectedType] || 0;
      const taxAmount = (consultationFee + platformFee) * taxRate;
      const total = consultationFee + platformFee + taxAmount;

      consultationFeeEl.textContent = '₹' + consultationFee.toFixed(2);
      platformFeeEl.textContent = '₹' + platformFee.toFixed(2);
      taxesEl.textContent = '₹' + taxAmount.toFixed(2);
      totalPriceEl.textContent = '₹' + total.toFixed(2);
    }

    // On page load initialize
    updatePrices('clinic_visit');

    // Handle radio change
    const radios = document.querySelectorAll('input[name="consultation_type"]');
    radios.forEach(radio => {
      radio.addEventListener('change', e => {
        if (e.target.checked) {
          updatePrices(e.target.value);
        }
      });
    });
  });

</script>

{% endblock content %}